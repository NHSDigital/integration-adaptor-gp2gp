<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2372px" preserveAspectRatio="none" style="width:1246px;height:2372px;background:#FFFFFF;" version="1.1" viewBox="0 0 1246 2372" width="1246px" zoomAndPan="magnify"><defs/><g><rect height="133.6641" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1200" x="30" y="84.2969"/><rect height="563.1953" style="stroke:#000000;stroke-width:1.5;fill:none;" width="745.5" x="20" y="231.9609"/><rect height="88.3984" style="stroke:#000000;stroke-width:1.5;fill:none;" width="615.5" x="30" y="385.625"/><rect height="46.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="725.5" x="30" y="488.0234"/><rect height="46.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="725.5" x="30" y="548.2891"/><rect height="90.2031" style="stroke:#000000;stroke-width:1.5;fill:none;" width="615.5" x="30" y="608.5547"/><rect height="46.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="725.5" x="30" y="741.8906"/><rect height="534.0625" style="stroke:#000000;stroke-width:1.5;fill:none;" width="765.5" x="10" y="809.1563"/><rect height="311.1328" style="stroke:#000000;stroke-width:1.5;fill:none;" width="745.5" x="20" y="833.2891"/><rect height="161.4688" style="stroke:#000000;stroke-width:1.5;fill:none;" width="615.5" x="30" y="886.5547"/><rect height="46.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="725.5" x="30" y="1091.1563"/><rect height="177.7969" style="stroke:#000000;stroke-width:1.5;fill:none;" width="745.5" x="20" y="1158.4219"/><rect height="46.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="725.5" x="30" y="1282.9531"/><rect height="193.9297" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1210" x="20" y="1357.2188"/><rect height="46.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="725.5" x="30" y="1497.8828"/><rect height="133.6641" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1200" x="30" y="1565.1484"/><rect height="298.3281" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1230" x="10" y="1712.8125"/><rect height="267.1953" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1210" x="20" y="1736.9453"/><rect height="59.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="211" x="30" y="1819.3438"/><rect height="46.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="725.5" x="30" y="1950.875"/><rect height="133.6641" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1200" x="30" y="2025.1406"/><rect height="104.5313" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1200" x="30" y="2172.8047"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="102" x2="102" y1="67.2969" y2="2294.3359"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="390.5" x2="390.5" y1="67.2969" y2="2294.3359"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="497.5" x2="497.5" y1="67.2969" y2="2294.3359"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="590.5" x2="590.5" y1="67.2969" y2="2294.3359"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="695.5" x2="695.5" y1="67.2969" y2="2294.3359"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="817.5" x2="817.5" y1="67.2969" y2="2294.3359"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1166" x2="1166" y1="67.2969" y2="2294.3359"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="40" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="47" y="55.9951">GP2GP Adaptor</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="40" y="2293.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="47" y="2313.3311">GP2GP Adaptor</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="330.5" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="337.5" y="55.9951">GPC Consumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="330.5" y="2293.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="337.5" y="2313.3311">GPC Consumer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="460.5" y="63.9951">MongoDB</text><path d="M480,15 C480,5 498,5 498,5 C498,5 516,5 516,15 L516,41 C516,51 498,51 498,51 C498,51 480,51 480,41 L480,15 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M480,15 C480,25 498,25 498,25 C498,25 516,25 516,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="460.5" y="2306.3311">MongoDB</text><path d="M480,2319.6328 C480,2309.6328 498,2309.6328 498,2309.6328 C498,2309.6328 516,2309.6328 516,2319.6328 L516,2345.6328 C516,2355.6328 498,2355.6328 498,2355.6328 C498,2355.6328 480,2355.6328 480,2345.6328 L480,2319.6328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M480,2319.6328 C480,2329.6328 498,2329.6328 498,2329.6328 C498,2329.6328 516,2329.6328 516,2319.6328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="545.5" y="63.9951">File storage</text><path d="M572.5,15 C572.5,5 590.5,5 590.5,5 C590.5,5 608.5,5 608.5,15 L608.5,41 C608.5,51 590.5,51 590.5,51 C590.5,51 572.5,51 572.5,41 L572.5,15 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M572.5,15 C572.5,25 590.5,25 590.5,25 C590.5,25 608.5,25 608.5,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="545.5" y="2306.3311">File storage</text><path d="M572.5,2319.6328 C572.5,2309.6328 590.5,2309.6328 590.5,2309.6328 C590.5,2309.6328 608.5,2309.6328 608.5,2319.6328 L608.5,2345.6328 C608.5,2355.6328 590.5,2355.6328 590.5,2355.6328 C590.5,2355.6328 572.5,2355.6328 572.5,2345.6328 L572.5,2319.6328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M572.5,2319.6328 C572.5,2329.6328 590.5,2329.6328 590.5,2329.6328 C590.5,2329.6328 608.5,2329.6328 608.5,2319.6328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M650.5,41 L740.5,41 C745.5,41 745.5,54.1484 745.5,54.1484 C745.5,54.1484 745.5,67.2969 740.5,67.2969 L650.5,67.2969 C645.5,67.2969 645.5,54.1484 645.5,54.1484 C645.5,54.1484 645.5,41 650.5,41 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M740.5,41 C735.5,41 735.5,54.1484 735.5,54.1484 C735.5,67.2969 740.5,67.2969 740.5,67.2969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="650.5" y="58.9951">Task queue</text><path d="M650.5,2293.3359 L740.5,2293.3359 C745.5,2293.3359 745.5,2306.4844 745.5,2306.4844 C745.5,2306.4844 745.5,2319.6328 740.5,2319.6328 L650.5,2319.6328 C645.5,2319.6328 645.5,2306.4844 645.5,2306.4844 C645.5,2306.4844 645.5,2293.3359 650.5,2293.3359 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M740.5,2293.3359 C735.5,2293.3359 735.5,2306.4844 735.5,2306.4844 C735.5,2319.6328 740.5,2319.6328 740.5,2319.6328 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="650.5" y="2311.3311">Task queue</text><path d="M760.5,41 L875.5,41 C880.5,41 880.5,54.1484 880.5,54.1484 C880.5,54.1484 880.5,67.2969 875.5,67.2969 L760.5,67.2969 C755.5,67.2969 755.5,54.1484 755.5,54.1484 C755.5,54.1484 755.5,41 760.5,41 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M875.5,41 C870.5,41 870.5,54.1484 870.5,54.1484 C870.5,67.2969 875.5,67.2969 875.5,67.2969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="760.5" y="58.9951">Inbound queue</text><path d="M760.5,2293.3359 L875.5,2293.3359 C880.5,2293.3359 880.5,2306.4844 880.5,2306.4844 C880.5,2306.4844 880.5,2319.6328 875.5,2319.6328 L760.5,2319.6328 C755.5,2319.6328 755.5,2306.4844 755.5,2306.4844 C755.5,2306.4844 755.5,2293.3359 760.5,2293.3359 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M875.5,2293.3359 C870.5,2293.3359 870.5,2306.4844 870.5,2306.4844 C870.5,2319.6328 875.5,2319.6328 875.5,2319.6328 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="760.5" y="2311.3311">Inbound queue</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="1112" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="1119" y="55.9951">MHS Adaptor</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="1112" y="2293.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="1119" y="2313.3311">MHS Adaptor</text><path d="M30,84.2969 L296,84.2969 L296,91.4297 L286,101.4297 L30,101.4297 L30,84.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:1.5;" width="1200" x="30" y="84.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221" x="45" y="97.3638">Receive EHR Extract Request</text><polygon fill="#181818" points="829,118.5625,819,122.5625,829,126.5625,825,122.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="823" x2="1165" y1="122.5625" y2="122.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="835" y="117.4966">Enqueue EHR Request (RCMR_IN010000UK05)</text><polygon fill="#181818" points="806,147.6953,816,151.6953,806,155.6953,810,151.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="812" y1="151.6953" y2="151.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="109.5" y="146.6294">Dequeue</text><polygon fill="#181818" points="486,176.8281,496,180.8281,486,184.8281,490,180.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="180.8281" y2="180.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="109.5" y="175.7622">Save new transfer</text><polygon fill="#181818" points="683.5,205.9609,693.5,209.9609,683.5,213.9609,687.5,209.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="209.9609" y2="209.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="109.5" y="204.895">Enqueue GET GPC Structure task</text><path d="M20,231.9609 L208,231.9609 L208,239.0938 L198,249.0938 L20,249.0938 L20,231.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="563.1953" style="stroke:#000000;stroke-width:1.5;" width="745.5" x="20" y="231.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="143" x="35" y="245.0278">Get GPC Structure</text><polygon fill="#181818" points="683.5,266.2266,693.5,270.2266,683.5,274.2266,687.5,270.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="270.2266" y2="270.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="109.5" y="265.1606">Dequeue</text><polygon fill="#181818" points="378.5,295.3594,388.5,299.3594,378.5,303.3594,382.5,299.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="384.5" y1="299.3594" y2="299.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="109.5" y="294.2935">POST ${gpc.migrateStructuredEndpoint}</text><polygon fill="#181818" points="113.5,324.4922,103.5,328.4922,113.5,332.4922,109.5,328.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="107.5" x2="389.5" y1="328.4922" y2="328.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="119.5" y="323.4263">FHIR Bundle</text><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="144.5" y1="357.625" y2="357.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="144.5" x2="144.5" y1="357.625" y2="370.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="103.5" x2="144.5" y1="370.625" y2="370.625"/><polygon fill="#181818" points="113.5,366.625,103.5,370.625,113.5,374.625,109.5,370.625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="109.5" y="352.5591">Translate FHIR to HL7</text><path d="M30,385.625 L102,385.625 L102,392.7578 L92,402.7578 L30,402.7578 L30,385.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="88.3984" style="stroke:#000000;stroke-width:1.5;" width="615.5" x="30" y="385.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="45" y="398.6919">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128" x="117" y="397.8354">[Large EHR Extract]</text><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="144.5" y1="423.8906" y2="423.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="144.5" x2="144.5" y1="423.8906" y2="436.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="103.5" x2="144.5" y1="436.8906" y2="436.8906"/><polygon fill="#181818" points="113.5,432.8906,103.5,436.8906,113.5,440.8906,109.5,436.8906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="418.8247">Compress EHR Extract</text><polygon fill="#181818" points="578.5,462.0234,588.5,466.0234,578.5,470.0234,582.5,466.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="466.0234" y2="466.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="109.5" y="460.9575">Upload Large EHR Extract</text><path d="M30,488.0234 L108,488.0234 L108,495.1563 L98,505.1563 L30,505.1563 L30,488.0234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:1.5;" width="725.5" x="30" y="488.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="45" y="501.0903">loop</text><polygon fill="#181818" points="683.5,522.2891,693.5,526.2891,683.5,530.2891,687.5,526.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="526.2891" y2="526.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="109.5" y="521.2231">Enqueue GET GPC Documents task</text><path d="M30,548.2891 L108,548.2891 L108,555.4219 L98,565.4219 L30,565.4219 L30,548.2891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:1.5;" width="725.5" x="30" y="548.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="45" y="561.356">loop</text><polygon fill="#181818" points="683.5,582.5547,693.5,586.5547,683.5,590.5547,687.5,586.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="586.5547" y2="586.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="109.5" y="581.4888">Enqueue GET Absent Attachments task</text><path d="M30,608.5547 L96,608.5547 L96,615.6875 L86,625.6875 L30,625.6875 L30,608.5547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="90.2031" style="stroke:#000000;stroke-width:1.5;" width="615.5" x="30" y="608.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="45" y="621.6216">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128" x="111" y="620.7651">[Large EHR Extract]</text><polygon fill="#181818" points="578.5,642.8203,588.5,646.8203,578.5,650.8203,582.5,646.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="646.8203" y2="646.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="109.5" y="641.7544">Upload EHR Extract Skeleton</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="645.5" y1="655.8203" y2="655.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114" x="35" y="666.0308">[Regular extract]</text><polygon fill="#181818" points="578.5,686.7578,588.5,690.7578,578.5,694.7578,582.5,690.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="690.7578" y2="690.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="109.5" y="685.6919">Upload EHR Extract</text><polygon fill="#181818" points="486,722.8906,496,726.8906,486,730.8906,490,726.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="726.8906" y2="726.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="721.8247">Update transfer status</text><path d="M30,741.8906 L102,741.8906 L102,749.0234 L92,759.0234 L30,759.0234 L30,741.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:1.5;" width="725.5" x="30" y="741.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="45" y="754.9575">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="258" x="117" y="754.1011">[Record translated and no documents]</text><polygon fill="#181818" points="683.5,776.1563,693.5,780.1563,683.5,784.1563,687.5,780.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="780.1563" y2="780.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="109.5" y="775.0903">Enqueue Send EHR Core Extract task</text><path d="M10,809.1563 L370,809.1563 L370,816.2891 L360,826.2891 L10,826.2891 L10,809.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="534.0625" style="stroke:#000000;stroke-width:1.5;" width="765.5" x="10" y="809.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="310" x="25" y="822.2231">Get documents and absent attachments</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="60" x="385" y="821.3667">[parallel]</text><path d="M20,833.2891 L98,833.2891 L98,840.4219 L88,850.4219 L20,850.4219 L20,833.2891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="311.1328" style="stroke:#000000;stroke-width:1.5;" width="745.5" x="20" y="833.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="35" y="846.356">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="113" y="845.4995">[GET GPC Documents]</text><polygon fill="#181818" points="378.5,867.5547,388.5,871.5547,378.5,875.5547,382.5,871.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="384.5" y1="871.5547" y2="871.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="109.5" y="866.4888">GET Document</text><path d="M30,886.5547 L96,886.5547 L96,893.6875 L86,903.6875 L30,903.6875 L30,886.5547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="161.4688" style="stroke:#000000;stroke-width:1.5;" width="615.5" x="30" y="886.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="45" y="899.6216">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="111" y="898.7651">[success]</text><polygon fill="#181818" points="113.5,920.8203,103.5,924.8203,113.5,928.8203,109.5,924.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="107.5" x2="389.5" y1="924.8203" y2="924.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="119.5" y="919.7544">FHIR Binary</text><polygon fill="#181818" points="578.5,949.9531,588.5,953.9531,578.5,957.9531,582.5,953.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="953.9531" y2="953.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="109.5" y="948.8872">Upload Document</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="645.5" y1="962.9531" y2="962.9531"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="55" x="35" y="973.1636">[failure]</text><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="144.5" y1="997.8906" y2="997.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="144.5" x2="144.5" y1="997.8906" y2="1010.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="103.5" x2="144.5" y1="1010.8906" y2="1010.8906"/><polygon fill="#181818" points="113.5,1006.8906,103.5,1010.8906,113.5,1014.8906,109.5,1010.8906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="109.5" y="992.8247">Create Absent Attachment placeholder</text><polygon fill="#181818" points="578.5,1036.0234,588.5,1040.0234,578.5,1044.0234,582.5,1040.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="1040.0234" y2="1040.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="109.5" y="1034.9575">Upload Absent Attachment</text><polygon fill="#181818" points="486,1072.1563,496,1076.1563,486,1080.1563,490,1076.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="1076.1563" y2="1076.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="1071.0903">Update transfer status</text><path d="M30,1091.1563 L102,1091.1563 L102,1098.2891 L92,1108.2891 L30,1108.2891 L30,1091.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:1.5;" width="725.5" x="30" y="1091.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="45" y="1104.2231">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="315" x="117" y="1103.3667">[All documents and absent attachments ready]</text><polygon fill="#181818" points="683.5,1125.4219,693.5,1129.4219,683.5,1133.4219,687.5,1129.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="1129.4219" y2="1129.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="109.5" y="1124.356">Enqueue Send EHR Core Extract task</text><path d="M20,1158.4219 L98,1158.4219 L98,1165.5547 L88,1175.5547 L20,1175.5547 L20,1158.4219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="177.7969" style="stroke:#000000;stroke-width:1.5;" width="745.5" x="20" y="1158.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="35" y="1171.4888">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="204" x="113" y="1170.6323">[Prepare absent attachments]</text><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="144.5" y1="1196.6875" y2="1196.6875"/><line style="stroke:#181818;stroke-width:1.0;" x1="144.5" x2="144.5" y1="1196.6875" y2="1209.6875"/><line style="stroke:#181818;stroke-width:1.0;" x1="103.5" x2="144.5" y1="1209.6875" y2="1209.6875"/><polygon fill="#181818" points="113.5,1205.6875,103.5,1209.6875,113.5,1213.6875,109.5,1209.6875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="109.5" y="1191.6216">Create Absent Attachment placeholder</text><polygon fill="#181818" points="578.5,1234.8203,588.5,1238.8203,578.5,1242.8203,582.5,1238.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="1238.8203" y2="1238.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="109.5" y="1233.7544">Upload Absent Attachment</text><polygon fill="#181818" points="486,1263.9531,496,1267.9531,486,1271.9531,490,1267.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="1267.9531" y2="1267.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="1262.8872">Update transfer status</text><path d="M30,1282.9531 L102,1282.9531 L102,1290.0859 L92,1300.0859 L30,1300.0859 L30,1282.9531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:1.5;" width="725.5" x="30" y="1282.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="45" y="1296.02">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="315" x="117" y="1295.1636">[All documents and absent attachments ready]</text><polygon fill="#181818" points="683.5,1317.2188,693.5,1321.2188,683.5,1325.2188,687.5,1321.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="1321.2188" y2="1321.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="109.5" y="1316.1528">Enqueue Send EHR Core Extract task</text><path d="M20,1357.2188 L239,1357.2188 L239,1364.3516 L229,1374.3516 L20,1374.3516 L20,1357.2188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="193.9297" style="stroke:#000000;stroke-width:1.5;" width="1210" x="20" y="1357.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="174" x="35" y="1370.2856">Send EHR Core Extract</text><polygon fill="#181818" points="578.5,1391.4844,588.5,1395.4844,578.5,1399.4844,582.5,1395.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="1395.4844" y2="1395.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="109.5" y="1390.4185">Download EHR Extract</text><polygon fill="#181818" points="486,1420.6172,496,1424.6172,486,1428.6172,490,1424.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="1424.6172" y2="1424.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="1419.5513">Update transfer status</text><polygon fill="#181818" points="1154,1449.75,1164,1453.75,1154,1457.75,1158,1453.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="1160" y1="1453.75" y2="1453.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="109.5" y="1448.6841">Send EHR Extract (RCMR_IN030000UK06)</text><polygon fill="#181818" points="486,1478.8828,496,1482.8828,486,1486.8828,490,1482.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="1482.8828" y2="1482.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="1477.8169">Update transfer status</text><path d="M30,1497.8828 L102,1497.8828 L102,1505.0156 L92,1515.0156 L30,1515.0156 L30,1497.8828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:1.5;" width="725.5" x="30" y="1497.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="45" y="1510.9497">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="233" x="117" y="1510.0933">[no documents - transfer finished]</text><polygon fill="#181818" points="683.5,1532.1484,693.5,1536.1484,683.5,1540.1484,687.5,1536.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="1536.1484" y2="1536.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="109.5" y="1531.0825">Enqueue Send ACK</text><path d="M30,1565.1484 L272,1565.1484 L272,1572.2813 L262,1582.2813 L30,1582.2813 L30,1565.1484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:1.5;" width="1200" x="30" y="1565.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197" x="45" y="1578.2153">Receive Continue Request</text><polygon fill="#181818" points="829,1599.4141,819,1603.4141,829,1607.4141,825,1603.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="823" x2="1165" y1="1603.4141" y2="1603.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="835" y="1598.3481">Enqueue Continue Request (COPC_IN000001UK01)</text><polygon fill="#181818" points="806,1628.5469,816,1632.5469,806,1636.5469,810,1632.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="812" y1="1632.5469" y2="1632.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="109.5" y="1627.481">Dequeue</text><polygon fill="#181818" points="486,1657.6797,496,1661.6797,486,1665.6797,490,1661.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="1661.6797" y2="1661.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="1656.6138">Update transfer status</text><polygon fill="#181818" points="683.5,1686.8125,693.5,1690.8125,683.5,1694.8125,687.5,1690.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="1690.8125" y2="1690.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="109.5" y="1685.7466">Enqueue Send Document tasks</text><path d="M10,1712.8125 L182,1712.8125 L182,1719.9453 L172,1729.9453 L10,1729.9453 L10,1712.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="298.3281" style="stroke:#000000;stroke-width:1.5;" width="1230" x="10" y="1712.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127" x="25" y="1725.8794">Send Documents</text><path d="M20,1736.9453 L98,1736.9453 L98,1744.0781 L88,1754.0781 L20,1754.0781 L20,1736.9453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="267.1953" style="stroke:#000000;stroke-width:1.5;" width="1210" x="20" y="1736.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="35" y="1750.0122">loop</text><polygon fill="#181818" points="683.5,1771.2109,693.5,1775.2109,683.5,1779.2109,687.5,1775.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="1775.2109" y2="1775.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="109.5" y="1770.145">Dequeue</text><polygon fill="#181818" points="578.5,1800.3438,588.5,1804.3438,578.5,1808.3438,582.5,1804.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="584.5" y1="1804.3438" y2="1804.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="109.5" y="1799.2778">Download file</text><path d="M30,1819.3438 L102,1819.3438 L102,1826.4766 L92,1836.4766 L30,1836.4766 L30,1819.3438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="211" x="30" y="1819.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="45" y="1832.4106">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119" x="117" y="1831.5542">[Large Document]</text><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="144.5" y1="1857.6094" y2="1857.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="144.5" x2="144.5" y1="1857.6094" y2="1870.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="103.5" x2="144.5" y1="1870.6094" y2="1870.6094"/><polygon fill="#181818" points="113.5,1866.6094,103.5,1870.6094,113.5,1874.6094,109.5,1870.6094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="109.5" y="1852.5435">split file</text><polygon fill="#181818" points="1154,1902.7422,1164,1906.7422,1154,1910.7422,1158,1906.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="1160" y1="1906.7422" y2="1906.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="109.5" y="1901.6763">Send document/chunk</text><polygon fill="#181818" points="486,1931.875,496,1935.875,486,1939.875,490,1935.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="1935.875" y2="1935.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="1930.8091">Update transfer status</text><path d="M30,1950.875 L102,1950.875 L102,1958.0078 L92,1968.0078 L30,1968.0078 L30,1950.875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:1.5;" width="725.5" x="30" y="1950.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="45" y="1963.9419">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="139" x="117" y="1963.0854">[All documents sent]</text><polygon fill="#181818" points="683.5,1985.1406,693.5,1989.1406,683.5,1993.1406,687.5,1989.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="1989.1406" y2="1989.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="109.5" y="1984.0747">Enqueue Send ACK</text><path d="M30,2025.1406 L146,2025.1406 L146,2032.2734 L136,2042.2734 L30,2042.2734 L30,2025.1406 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:1.5;" width="1200" x="30" y="2025.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="45" y="2038.2075">Send ACK</text><polygon fill="#181818" points="683.5,2059.4063,693.5,2063.4063,683.5,2067.4063,687.5,2063.4063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="689.5" y1="2063.4063" y2="2063.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="109.5" y="2058.3403">Dequeue</text><polygon fill="#181818" points="486,2088.5391,496,2092.5391,486,2096.5391,490,2092.5391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="2092.5391" y2="2092.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="2087.4731">Update transfer status</text><polygon fill="#181818" points="1154,2117.6719,1164,2121.6719,1154,2125.6719,1158,2121.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="1160" y1="2121.6719" y2="2121.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="109.5" y="2116.606">Send ACK (MCCI_IN010000UK13)</text><polygon fill="#181818" points="486,2146.8047,496,2150.8047,486,2154.8047,490,2150.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="2150.8047" y2="2150.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="2145.7388">Update transfer status</text><path d="M30,2172.8047 L251,2172.8047 L251,2179.9375 L241,2189.9375 L30,2189.9375 L30,2172.8047 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="104.5313" style="stroke:#000000;stroke-width:1.5;" width="1200" x="30" y="2172.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="176" x="45" y="2185.8716">Receive final ACK/NACK</text><polygon fill="#181818" points="829,2207.0703,819,2211.0703,829,2215.0703,825,2211.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="823" x2="1165" y1="2211.0703" y2="2211.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323" x="835" y="2206.0044">Enqueue acknowledgement (MCCI_IN010000UK13)</text><polygon fill="#181818" points="806,2236.2031,816,2240.2031,806,2244.2031,810,2240.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="812" y1="2240.2031" y2="2240.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="109.5" y="2235.1372">Dequeue</text><polygon fill="#181818" points="486,2265.3359,496,2269.3359,486,2273.3359,490,2269.3359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="102.5" x2="492" y1="2269.3359" y2="2269.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="109.5" y="2264.27">Update transfer status</text><!--MD5=[155b6049253fdd8277e25c01da5b8868]
@startuml
participant "GP2GP Adaptor" as gp2gp
participant "GPC Consumer" as gpc
database MongoDB as mongo
database "File storage" as storage
queue "Task queue" as task
queue "Inbound queue" as inbound
participant "MHS Adaptor" as mhs

group Receive EHR Extract Request
  mhs -> inbound: Enqueue EHR Request (RCMR_IN010000UK05)
  gp2gp -> inbound: Dequeue
  gp2gp -> mongo: Save new transfer
  gp2gp -> task: Enqueue GET GPC Structure task
end

group Get GPC Structure
  gp2gp -> task: Dequeue
  gp2gp -> gpc: POST ${gpc.migrateStructuredEndpoint}
  gpc - -> gp2gp: FHIR Bundle
  gp2gp -> gp2gp: Translate FHIR to HL7

  opt Large EHR Extract
    gp2gp -> gp2gp: Compress EHR Extract
    gp2gp -> storage: Upload Large EHR Extract
  end
  
  loop
    gp2gp -> task: Enqueue GET GPC Documents task
  end
  
  loop
    gp2gp -> task: Enqueue GET Absent Attachments task
  end
  
  alt Large EHR Extract
    gp2gp -> storage: Upload EHR Extract Skeleton
  else Regular extract
    gp2gp -> storage: Upload EHR Extract
  end

  gp2gp -> mongo: Update transfer status

  opt Record translated and no documents
    gp2gp -> task: Enqueue Send EHR Core Extract task
  end
end

group Get documents and absent attachments [parallel]
  loop GET GPC Documents
    gp2gp -> gpc: GET Document

    alt success
      gpc - -> gp2gp: FHIR Binary
      gp2gp -> storage: Upload Document
    else failure
      gp2gp -> gp2gp: Create Absent Attachment placeholder
      gp2gp -> storage: Upload Absent Attachment
    end

    gp2gp -> mongo: Update transfer status

    opt All documents and absent attachments ready
      gp2gp -> task: Enqueue Send EHR Core Extract task
    end
  end

  loop Prepare absent attachments
    gp2gp -> gp2gp: Create Absent Attachment placeholder
    gp2gp -> storage: Upload Absent Attachment
    gp2gp -> mongo: Update transfer status

    opt All documents and absent attachments ready
      gp2gp -> task: Enqueue Send EHR Core Extract task
    end
  end
end

group Send EHR Core Extract
  gp2gp -> storage: Download EHR Extract
  gp2gp -> mongo: Update transfer status
  gp2gp -> mhs: Send EHR Extract (RCMR_IN030000UK06)
  gp2gp -> mongo: Update transfer status

  opt no documents - transfer finished
    gp2gp -> task: Enqueue Send ACK
  end
end

group Receive Continue Request
  mhs -> inbound: Enqueue Continue Request (COPC_IN000001UK01)
  gp2gp -> inbound: Dequeue
  gp2gp -> mongo: Update transfer status
  gp2gp -> task: Enqueue Send Document tasks
end

group Send Documents
  loop
    gp2gp -> task: Dequeue
    gp2gp -> storage: Download file
    
    opt Large Document
      gp2gp -> gp2gp: split file
    end
    
    gp2gp -> mhs: Send document/chunk
    gp2gp -> mongo: Update transfer status
    
    opt All documents sent
      gp2gp -> task: Enqueue Send ACK
    end
  end
end

group Send ACK
  gp2gp -> task: Dequeue
  gp2gp -> mongo: Update transfer status
  gp2gp -> mhs: Send ACK (MCCI_IN010000UK13)
  gp2gp -> mongo: Update transfer status
end

group Receive final ACK/NACK
  mhs -> inbound: Enqueue acknowledgement (MCCI_IN010000UK13)
  gp2gp -> inbound: Dequeue
  gp2gp -> mongo: Update transfer status
end
@enduml

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>